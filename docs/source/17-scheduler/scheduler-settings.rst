Администрирование планировщика заданий
======================================

Планировщик заданий InfinniPlatform предоставляет несколько аспектов администрирования.


.. _job-instance:

Журнал планировщика заданий
---------------------------

Каждый экземпляр задания обрабатывается один раз на одном из узлов кластера, при этом сам факт обработки задания
фиксируется в **журнале планировщика заданий** в рамках :doc:`постоянного хранилища </08-document-storage/index>`.
Каждая запись журнала имеет уникальный идентификатор, который совпадает с
:ref:`уникальным идентификатором экземпляра задания <job-handler-context>`,
а также дополнительную информацию, связанную с его обработкой.


.. index:: SchedulerSettings

Конфигурация планировщика заданий
---------------------------------

Ниже приведен пример настройки планировщика заданий InfinniPlatform в :doc:`файле конфигурации приложения </04-settings/index>`.

.. code-block:: js
   :caption: AppExtension.json

    "scheduler": {
      "ExpireHistoryAfter": null
    }

На данный момент конфигурация содержит единственную настройку - атрибут ``ExpireHistoryAfter``, с помощью которого можно определить
максимальное время хранения информации (в секундах) о вызове обработчиков заданий в :ref:`журнале планировщика заданий <job-instance>`.
По умолчанию значение данного атрибута не задано (``null``) и время хранения записей журнала не ограничено.

Автоматическую очистку журнала можно реализовать явно указав значение атрибута ``ExpireHistoryAfter``. Следующая конфигурация определяет,
что журнал должен содержать информацию только за последние сутки (24 часа - 86400 секунд).

.. code-block:: js
   :caption: AppExtension.json

    "scheduler": {
      "ExpireHistoryAfter": 86400
    }


REST-сервис планировщика заданий
--------------------------------

Планировщик заданий InfinniPlatform предоставляет административный REST-сервис, позволяющий контролировать состояние планировщика
во время работы приложения, а также управлять заданиями. В целях обеспечения безопасности вызов сервисов возможен только с узла,
на котором работает экземпляр приложения. Ниже приведена краткая информация по каждому из методов сервиса.

.. http:get:: /scheduler/

    Определяет, запущен ли планировщик заданий, а также возвращает количество запланированных и приостановленных заданий.

.. http:get:: /scheduler/jobs?state={planned|paused}&skip={skip}&take={take}

    Возвращает список заданий, находящихся в указанном состоянии (запланированы - ``planned``, приостановлены - ``paused``).

.. http:get:: /scheduler/jobs/{id}

    Возвращает :doc:`информацию об указанном задании </17-scheduler/scheduler-jobinfo>`.

.. http:post:: /scheduler/jobs/{id}

    :ref:`Добавляет или обновляет <add-or-update-job>` указанное задание.

.. http:delete:: /scheduler/jobs/{id}

    :ref:`Удаляет <delete-job>` указанное задание.

.. http:post:: /scheduler/pause?ids={id,...}

    :ref:`Приостанавливает планирование <pause-job>` указанных заданий.

.. http:post:: /scheduler/resume?ids={id,...}

    :ref:`Возобновляет планирование <resume-job>` указанных заданий.

.. http:post:: /scheduler/trigger?ids={id,...}

    :ref:`Вызывает досрочное выполнение <trigger-job>` указанных заданий.
